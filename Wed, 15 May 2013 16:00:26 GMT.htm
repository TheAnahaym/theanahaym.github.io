<p style="text-align: justify;">&nbsp;Данная статья о миграции в случае, когда компьютер выходит из одного домена, и подключается к другому домену, или недоменный компьютер подключается к домену. Миграция будет осуществляться программой <a href="http://www.forensit.com/domain-migration.html">Profile Migration Wizard</a>. Статью решил написать, так как миграция такого типа стала чаще встречаться, а работу программы нет просто понять. Дело в том, что на самом деле никакой миграции не происходит, так как данные никуда не перемещаются. Ну и просто меня попросили написать статью о ней ) На сколько я понял данная программа переписывает все SIDы и ACLы одного пользователя на другой. Именно SIDы и ACLы не позволяют применить способ копипаста, который работал в ХР (это было давно, и я могу ошибаться). У данной программы есть один минус (а может это и плюс): после миграции все пароли (в браузерах, в Outlook) сбрасываются. Возможно это сделано специально для безопасности. И так, приступим.</p>
<p style="text-align: justify;">&nbsp;Миграцию профилей я буду показывать на примере двух доменов 2008 R2 и 2012. Клиентская ОС - Windows 8 Ent Eval x64. Для Windows 7 всё выполняется аналогично. Рекомендую сделать полные бекапы клиентских ОС. <span style="color: #ff0000;"><strong>А так же экспортировать все пароли из браузеров</strong></span>. <strong>Из-за безопасности все <span style="color: rgb(224, 62, 45);">клиент-банки</span> перенастраиваются вручную</strong>! Конфигурация доменов:</p>
<p>&nbsp;<img height="768" width="1024" alt="migr1.png" src="1665329145299.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p>&nbsp;<img height="768" width="1024" alt="migr2.png" src="1665329145301.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">&nbsp;В каждом домене были созданы по одному пользователю. В домене 2008 R2 - UserA, в домене 2012 - UserB. Если мигрирующих пользователей в Active Directory очень много, то можно использовать <a target="_blank" rel="noopener" href="http://technet.microsoft.com/en-us/library/cc974415(v=ws.10).aspx">ADMT</a> для миграции учётных записей из домена в домен. ADMT не поддерживается SBS редакциями, так как они не поддерживают доверительные отношения между доменами (к счастью, на помощь приходит межлесовая миграция почтовых ящиков Exchange вместе с учётками). Выводим и вводим Windows-8 из домена в домен (можно за один шаг просто перейти в новый домен, только не забудьте поменять DNS в настройках сетевой карты, иначе новый домен просто не "увидится"). Для проверки я создал текстовый файл на рабочем столе пользователя UserA.</p>
<p>&nbsp;&nbsp;<img height="768" width="1024" alt="migr3.png" src="1665329145303.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">&nbsp;Входим в систему администратором второго домена и скачиваем программу. Запускаем от имени администратора.</p>
<p>&nbsp;<img height="768" width="1024" alt="migr4.png" src="1665329145305.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p>&nbsp;<img height="768" width="1024" alt="migr5.png" src="1665329145307.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">&nbsp;Я снимаю галку для "входа по умолчанию" и ввожу имя <span style="color: #ff0000;"><strong>новой</strong></span> учётной записи.</p>
<p>&nbsp;<img height="768" width="1024" alt="migr6.png" src="1665329145309.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">&nbsp;Вместо имён пользователей первого домена мы видим их SIDы, т.к. новый домен не может сопоставить чужие SIDы с именами. Но мы видим путь для профиля, по которому мы и определяем нужный профиль и указываем его.</p>
<p>&nbsp;<img height="768" width="1024" alt="migr7.png" src="1665329145311.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">&nbsp;Дальше программа делает фокус: перезаписывает все SIDы и ACLы старого профиля на SIDы и ACLы нового пользователя. О чём собственно она и сообщает нам. Так как профиль чистый, нет никаких данных, установленных программ, то миграция длилась меньше секунды. Если вы будете мигрировать большие профили, то процесс может занять и час, а может и больше. Рекомендую перед миграцией почистить временные файлы интернета.</p>
<p>&nbsp;<img height="768" width="1024" alt="migr8.png" src="1665329145313.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p>&nbsp;<img height="768" width="1024" alt="migr9.png" src="1665329145315.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p>&nbsp;<img height="768" width="1024" alt="migr10.png" src="1665329145317.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">&nbsp;Заходим новым пользователем в систему. Проверяем кто мы в PowerShell. Проверяем путь к новой папке в "Мои Документах". И как видите в дереве папок есть только папка старого пользователя - usera. Это наверное второй минус программы. Но с другой стороны - она за бесплатно и так нам много сделала. Спасибо! Я <span style="color: #ff0000;"><strong>не</strong></span> рекомендую вручную менять названия user<strong>a</strong> на user<strong>b</strong> - в настройках ваших программ уже указана именно эта папка user<strong>a</strong>. С этим придётся смерится. На этом всё.</p>
<p>&nbsp;<img height="768" width="1024" alt="migr11.png" src="1665329145319.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: right;"><em>23.04.2013</em></p>
<p style="text-align: justify;">&nbsp;</p>
<div id="vk_comments"></div>