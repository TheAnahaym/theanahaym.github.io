<div></div>
<p style="text-align: center;"><strong>Настройка маршрутизации сетей Windows и Linux</strong></p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: justify;">&nbsp;Routing and Remote Access - RRAS. Предоcтавляет сервисы маршрутизации сетей, VPN доступ, NAT, Dial-up доступ, Demand-dial соединения для филиалов. Мною используется в статье "<a href="http://www.exonix.ru/?ekxirklatv5gmlf8zvuphhw.htm">Доверительные отношения между 2008 R2 и 2012</a>".</p>
<p style="text-align: justify;">Так же маршрутизацию сетей можно реализовать сердствами Linux. напишу два метода, для сравнения создания маршрутизации. Начнём с Windows + RRAS:</p>
<pre>&nbsp;<span>Windows IP Configuration<br></span>&nbsp;<span>&nbsp; Host Name . . . . . . . . . . . . : RRAS<br></span><span>&nbsp; &nbsp;Primary Dns Suffix &nbsp;. . . . . . . :<br></span><span>&nbsp; &nbsp;Node Type . . . . . . . . . . . . : Hybrid<br></span><span>&nbsp; &nbsp;IP Routing Enabled. . . . . . . . : Yes<br></span><span>&nbsp; &nbsp;WINS Proxy Enabled. . . . . . . . : No<br>&nbsp; &nbsp;DNS Suffix Search List. . . . . . :&nbsp;<br></span><br>Ethernet adapter Local Area Connection 2:<br>&nbsp; &nbsp;Connection-specific DNS Suffix &nbsp;. :<br>&nbsp; &nbsp;Description . . . . . . . . . . . : Microsoft Virtual Machine Bus Network Adapter #2<br>&nbsp; &nbsp;Physical Address. . . . . . . . . : 00-15-5D-0A-13-0A<br>&nbsp; &nbsp;DHCP Enabled. . . . . . . . . . . : No<br>&nbsp; &nbsp;Autoconfiguration Enabled . . . . : Yes<br>&nbsp; &nbsp;Link-local IPv6 Address . . . . . : fe80::5467:641d:1be1:7ed1%13(Preferred)<br>&nbsp; &nbsp;IPv4 Address. . . . . . . . . . . :&nbsp;<strong>10.10.10.1</strong>(Preferred)<br>&nbsp; &nbsp;Subnet Mask . . . . . . . . . . . : 255.255.255.0<br>&nbsp; &nbsp;Default Gateway . . . . . . . . . :<br>&nbsp; &nbsp;DHCPv6 IAID . . . . . . . . . . . : 301995357<br>&nbsp; &nbsp;DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-18-33-D2-4E-00-15-5D-0A-13-0B<br>&nbsp; &nbsp;DNS Servers . . . . . . . . . . . : 10.10.10.100<br>&nbsp; &nbsp;NetBIOS over Tcpip. . . . . . . . : Enabled<br><br>Ethernet adapter Local Area Connection:<br>&nbsp; &nbsp;Connection-specific DNS Suffix &nbsp;. :<br>&nbsp; &nbsp;Description . . . . . . . . . . . : Microsoft Virtual Machine Bus Network Adapter<br>&nbsp; &nbsp;Physical Address. . . . . . . . . : 00-15-5D-0A-13-0B<br>&nbsp; &nbsp;DHCP Enabled. . . . . . . . . . . : No<br>&nbsp; &nbsp;Autoconfiguration Enabled . . . . : Yes<br>&nbsp; &nbsp;Link-local IPv6 Address . . . . . : fe80::6d11:cb0e:d870:22f2%11(Preferred)<br>&nbsp; &nbsp;IPv4 Address. . . . . . . . . . . :&nbsp;<strong>172.16.16.1</strong>(Preferred)<br>&nbsp; &nbsp;Subnet Mask . . . . . . . . . . . : 255.255.255.0<br>&nbsp; &nbsp;Default Gateway . . . . . . . . . :<br>&nbsp; &nbsp;DHCPv6 IAID . . . . . . . . . . . : 234886493<br>&nbsp; &nbsp;DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-18-33-D2-4E-00-15-5D-0A-13-0B<br>&nbsp; &nbsp;DNS Servers . . . . . . . . . . . : 172.16.16.100<br>&nbsp; &nbsp;NetBIOS over Tcpip. . . . . . . . : Enabled</pre>
<p style="text-align: justify;">&nbsp;</p>
<p><img height="376" width="512" alt="rras1.png" src="1665329145145.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p><img height="423" width="500" alt="rras2.png" src="1665329145147.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p><img height="423" width="500" alt="rras3.png" src="1665329145149.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">Теперь о настройке в Linux. Нужно просто выполнить команду:</p>
<pre style="text-align: justify;"><span>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></pre>
<p style="text-align: justify;">&nbsp;Во время создания доверий изначально я делал маршрутизацию не через RRAS. Изначально каждый гостевой сервер имел одну сетевую карту INTERNAL. Ею я мог управлять на хостовом сервере. Было сделано просто:</p>
<pre style="text-align: justify;">Ethernet adapter vEthernet (INTERNAL):<br>&nbsp;&nbsp; Connection-specific DNS Suffix &nbsp;. :<br>&nbsp; &nbsp;Link-local IPv6 Address . . . . . : fe80::deb:df1c:f386:4dfa%20<br>&nbsp; &nbsp;IPv4 Address. . . . . . . . . . . : 10.10.10.1<br>&nbsp; &nbsp;Subnet Mask . . . . . . . . . . . : 255.255.255.0<br>&nbsp; &nbsp;IPv4 Address. . . . . . . . . . . : 172.16.16.1<br>&nbsp; &nbsp;Subnet Mask . . . . . . . . . . . : 255.255.255.0<br>&nbsp; &nbsp;Default Gateway . . . . . . . . . :</pre>
<div>&nbsp;При данной конфигурации работали и ping и nslookup. И даже создавались внешние доверия, но по отдельности в каждом домене. При создании доверия в удалённом домене получал ошибку:</div>
<p style="text-align: justify;">- The operation failed. The error is: the directory datatype cannot be converted to/from a native DS datatype</p>
<div><img height="485" width="559" alt="" src="http://fs.exonix.ru/resource/image/addt16.png" style="display: block; margin-left: auto; margin-right: auto;"></div>
<p style="text-align: justify;">При назначении прав получал следующие ошибки:<br>&nbsp;- Unable to lookup user names for display<br>&nbsp;- The Active Directory Domain Controllers required to find the selected objects in the following domain are not available</p>
<p><img alt="" src="http://fs.exonix.ru/resource/image/addt15.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p><img alt="" src="http://fs.exonix.ru/resource/image/addt17.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: right;"><em>24.10.2012</em></p>
<p style="text-align: justify;">&nbsp;</p>
<div id="vk_comments">&nbsp;</div>