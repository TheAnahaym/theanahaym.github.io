<p style="text-align: justify;">Старая статья. Моя самая первая )</p>
<p style="text-align: justify;"><span style="font-size: larger;" data-mce-mark="1">компиляция ядра</span></p>
<p style="text-align: justify;"><span style="font-size: larger;"># Идем в каталог с конфигурационными файлами ядра Если такого каталога нет, это значит, <br /> # что вы не установили kernel-development при инсталяции FreeBSD. Или проще - у вас нет исходных текстов ядра. <br /> # Для того, чтобы они появились на вашем жестком диске нужно установить пакет kernel-devel. <br /> # Обычно он находится на первом инсталяционном диске. <br /> <br /> cd /usr/src/sys/i386/conf/ <br /> cp GENERIC GENERIC.old <br /> vi GENERIC <br /> <br /> # Файл GENERIC - это та конфигурация ядра, которая была сделанная при инсталяции системы <br /> # Для того, чтобы включить в ядро поддержку ipfw и natd надо добавить в GENERIC вот такие строки: <br /> <br /> options IPFIREWALL <br /> options IPFIREWALL_VERBOSE <br /> options IPFIREWALL_VERBOSE_LIMIT=10 <br /> options IPDIVERT <br /> options IPFIREWALL_DEFAULT_TO_ACCEPT <br /> options DUMMYNET <br /> <br /> # Здесь IPFIREWALL означает включение программы файервола ipfw, <br /> # IPFIREWALL_VERBOSE означает ведение логов ipfw, <br /> # IPFIREWALL_VERBOSE_LIMIT=10 ограничичивает максимальное число записей, которые могут быть сделаны в секунду. <br /> # Учитывайте то, что если вы поставите большое число для IPFIREWALL_VERBOSE_LIMIT, то ваш винчестер может <br /> # засориться от быстрорастущих логов. <br /> # IPDIVERT означает включение демона маскарадинга natd, <br /> # IPFIREWALL_DEFAULT_TO_ACCEPT означает, что ваш файервол по дефолту будет открытым. <br /> # Если вы не указываете этой опции, то при старте файервола любой доступ из сети к компьютеру будет закрыт. <br /> # DUMMYNET означает, что вы сможете контролировать скорость передачи через ваш компьютер. <br /> # Теперь компилируем ядро <br /> <br /> config GENERIC <br /> cd ../compile/GENERIC/ <br /> make depend <br /> make <br /> make install <br /> <br /> # Если на каком-то шаге компиляции команда make depend или make выйдет, сказав вам об ошибке, то не расстраивайтесь, <br /> # а просто попробуйте перезапустить команду заново при этом приблизительно запомнив о чем говорилось в тексте ошибки. <br /> # Если после этого опять возникнет ошибка, то проверьте похожа ли она на предыдущую. В случае несовпадения смело <br /> # повторяйте последнюю команду. <br /> <br /> </span></p>
<p style="text-align: justify;"><span style="font-size: larger;">настройка сервиса маршрутизации и натирования адресов</span></p>
<p style="text-align: justify;"><span style="font-size: larger;"> # Скажем ядру, чтобы при старте он понимал, что этот компьютер - роутер. <br /> <br /> cd /etc/ <br /> vi rc.conf <br /> <br /> # Для этого надо отредактировать файл rc.conf в соответствии с приведенным ниже строками: <br /> <br /> gateway_enable="YES" <br /> firewall_enable="YES" <br /> firewall_quiet="YES" <br /> firewall_type="OPEN" <br /> natd_enable="YES" <br /> natd_interface="rl0"<br /> natd_flags=""<br /> mysql_enable="YES" <br /> <br /> # Я сразу включил базы данные, т.к. они нам понадобятся в дальнейшем. <br /> # К примеру, сетевая карта, которая подключена к интернету имеет название rl0 и ее ip-адрес в интернете 192.168.15.99, <br /> # а сетевая карта, которая подключена к локальной имеет название rl1 и ее ip-адрес в локальной сети 10.0.0.1. <br /> # Следующий шаг - это настройка самих ipfw и natd. <br /> <br /> cd /etc <br /> vi natd.conf <br /> <br /> # Вставьте в файл natd.conf следующие строки: <br /> <br /> alias_address 192.168.15.99 <br /> target_address 10.10.10.1 <br /> log yes <br /> log_denied yes <br /> use_sockets yes <br /> same_ports yes <br /> unregistered_only yes <br /> <br /> # Если хотите прочитать что значат каждая из этих строк подробнее, то смотрите "man natd" <br /> # Теперь пропишем ipfw и natd в автозагрузку. <br /> <br /> cd /usr/local/etc/rc.d/ <br /> vi ipfw_natd.sh <br /> <br /> # Вставьте в файл ipfw_natd.sh эти строки: <br /> <br /> #!/bin/sh <br /> natd -f /etc/natd.conf <br /> ipfw add 500 divert natd all from any to any via rl0 <br /> ipfw add 501 pass all from any to any <br /> <br /> # Это означает, что мы включаем маскарадинг с помощью natd через ipfw, разрешаем всем соединяться с сервером, <br /> # как если бы он был без файервола и разрешаем всем из локльной сети ходить в интернет. <br /> # Сделаем скрипт в автозагрузке выполняемым <br /> <br /> chmod +x ipfw_natd.sh <br /> <br /> reboot</span></p>