<div>
<p style="text-align: center;"><strong>Локальная Сеть IPv4</strong></p>
<p>&nbsp;</p>
</div>
<p style="text-align: justify;">&nbsp;Целью данной статьи является объяснить как работает локальная сеть.&nbsp;Я расскажу для чего нужен IP адрес, маска, шлюз по умолчанию, DNS и немного маршрутизации. Взгляните на схему компьютерной сети. На ней изображена локальная сеть из трёх компьютеров (Winodws 7 и 8, и Debian 7), роутера (маршрутизатор), свитча (коммутатор). Пусть наш коммутатор поддерживает функцию <a target="_blank" rel="noopener" href="http://ru.wikipedia.org/wiki/Medium_Dependent_Interface">MDIX</a>&nbsp;- автоопределение типа кабеля. В таком случае мы можем использовать как <a target="_blank" rel="noopener" href="http://ru.wikipedia.org/wiki/%D0%92%D0%B8%D1%82%D0%B0%D1%8F_%D0%BF%D0%B0%D1%80%D0%B0#.D0.9F.D1.80.D1.8F.D0.BC.D0.BE.D0.B9_.D0.BA.D0.B0.D0.B1.D0.B5.D0.BB.D1.8C_.28straight_through_cable.29">прямой</a> так и <a target="_blank" rel="noopener" href="http://ru.wikipedia.org/wiki/%D0%92%D0%B8%D1%82%D0%B0%D1%8F_%D0%BF%D0%B0%D1%80%D0%B0#.D0.9F.D0.B5.D1.80.D0.B5.D0.BA.D1.80.D1.91.D1.81.D1.82.D0.BD.D1.8B.D0.B9_.D0.BA.D0.B0.D0.B1.D0.B5.D0.BB.D1.8C_.28crossover_cable.29">кросс</a> патч-корд, в противном случае только прямой. Так же на смехе изображён отдельный компьютер, подключённый напрямую к сети Интернет. Данная топология локальной сети называется "<a target="_blank" rel="noopener" href="http://ru.wikipedia.org/wiki/%D0%97%D0%B2%D0%B5%D0%B7%D0%B4%D0%B0_(%D1%82%D0%BE%D0%BF%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F_%D0%BA%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%BD%D0%BE%D0%B9_%D1%81%D0%B5%D1%82%D0%B8)">Звезда</a>". Так как в сети отсутствуют сервера с приложениями, сеть является&nbsp;<a target="_blank" rel="noopener" href="http://ru.wikipedia.org/wiki/%CE%E4%ED%EE%F0%E0%ED%E3%EE%E2%E0%FF_%F1%E5%F2%FC">одноранговой</a>.</p>
<p><img alt="" src="http://fs.exonix.ru/network/ip1.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">&nbsp;Если мы просто соеденим три компьютера между собой с помощью Ethernet-кабеля, то без DHCP сервера или ручной настройки, компьютеры по умолчанию автоматически настроятся с помощью <a target="_blank" rel="noopener" href="http://ru.wikipedia.org/wiki/Zeroconf">APIPA</a>, кроме Debain 7. Однако работать с такой сетью будет не очень удобно, по этому мы вручную настроим наши компьютеры. Я сразу укажу в настройках адрес шлюза по умолчанию и ДНС. <strong>IP адрес</strong> должен быть уникальным для каждого компьютера в сети, так как это его уникальных сетевой идентификатор, как например почтовый адрес с фамилией получателя. <strong>Маска сети</strong> определяет границы сети, её первый адрес (идентификатор сети) и последний адрес (broadcast). В нашем случае NetworkID - 10.10.10.0, Broadcast - 10.10.10.255. Всего существует 33 сетевых маски. Посмотреть все маски и потренироваться в вычислении количества IP адресов для компьютеров, а так же Broadcast-ов можно в <a target="_blank" rel="noopener" href="http://ip-calculator.ru/">онлайн IP-калькуляторе</a>. Для работы только локальной сети <strong>шлюз по умолчанию</strong> не нужен, а вот для того, чтобы попасть за пределы локальной сети, в том числе в сеть Internet, необходим шлюз по умолчанию. Если у вас две сети 10.10.10.0.24 и 192.168.0.0/24, но в пределах одной физической сети, то вам также нужен будет шлюз по умолчанию, который будет иметь два интерфейса: по одному для каждой сети. Часто, для подключения используют Ethernet-маршуртизаторы или xDSL-модемы. Именно они и являются шлюзами в Internet и их внутренний&nbsp;IP адрес нужно указывать в качестве шлюза по умолчанию. Так же можно указать IP адреса серверов, на которых установлены приложения вроде ISA 200X, TMG, Kerio Control, UserGate, а так же&nbsp;<span>Windows Server с ролью RRAS, Unix-like решения</span>&nbsp;и другие приложения. Если же нет специального оборудования для доступа в Интернет, а просто приходит "шнурок" от провайдера - необходимо спросить у провайдера настройки для сетевой карты, но в большенстве случаев все настройки задаются с помощью <a href="#!Статьи.Windows_Server_Services.DHCP_2008_R2">DHCP</a>. <strong>DNS сервера</strong> нужны для разрешения (преобразования) доменных имён в IP адреса. Без него нельзя будет зайти на <a target="_blank" rel="noopener" href="http://google.ru">Гугл</a>, но можно будет зайти, например, по адресу&nbsp;<a target="_blank" rel="noopener" href="http://173.194.69.94/">173.194.69.94</a>. Что удобнее запомнить IP адрес или имя веб-сайта?! Если на одном IP адресе несколько веб-сайтов, то веб-сервер сам определяет какой ресурс был запрошен. Обычно провайдеры предоставляют два DNS сервера, но можно задать и больше в дополнительных настройках. Хотя, если используется надёжный DNS сервер (т.е. он всегда доступен), то хватит и одного DNS сервера. В сетях с рабочей группой ДНС сервером может быть любой доступный ДНС сервер, например маршрутизатор или от гугла 8.8.8.8. <span style="color: #ff0000;">В сетях с Active Directory у всех клиентов введёных в домен должен быть установлен <strong>только ДНС</strong> сервер локальной сети, содержащий зону вашего домена, интегрированную в Active Directory</span>. Как правило - это контроллер домена, но поддерживаются и Unix ДНС сервер BIND от версии 8.2.</p>
<p style="text-align: justify;">&nbsp;Ниже приведены настройки компьютеров в тестовой локальной сети.&nbsp;<strong>Для Debian 7</strong>:</p>
<pre><em></em>cat /etc/network/interfaces<br># The loopback network interface<br>auto lo<br>iface lo inet loopback<br>allow-hotplug eth0<br>iface eth0 inet static<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; address 10.10.10.50<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; netmask 255.255.255.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; network 10.10.10.0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; broadcast 10.10.10.255<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gateway 10.10.10.10</pre>
<p>&nbsp;DNS сервер:</p>
<pre>cat /etc/resolv.conf<br>nameserver 10.10.10.10</pre>
<p><strong>&nbsp;Для Windows</strong>:</p>
<p><a target="_blank" rel="noopener" href="http://fs.exonix.ru/network/LAN/lan1.png"><img height="513" width="498" alt="lan1.png" src="1665329145091.png" style="display: block; margin-left: auto; margin-right: auto;"></a><a target="_blank" rel="noopener" href="http://fs.exonix.ru/network/LAN/lan2.png">&nbsp;</a></p>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: justify;">&nbsp;<strong>Для Ubunutu 13.04&nbsp;</strong>(маску можно писать в сокращённом виде /24):</p>
<p><img height="864" width="1152" alt="lan5.png" src="1665329145089.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">&nbsp;Немного об особенностях сетей Windows. Если в сетевом интерфейсе не указан шлюз по умолчанию, или указан несуществующий адрес, то тип сети будет определён как Общедоступный или Public. А это означает, что сетевой интерфейс будет блокировать все входящие соединения. Если мы попытаемся проверить доступность компьютеров с помощью ping с компьютера Windows 8, то Debian ответит, а Windows 7 будет недоступен. Всё это правится в настройках Firewall Windows или если поменять тип сети на Домашняя (Home) или Рабочая (Work). В Windows 8 Домашняя и Рабочая объедены в Частную (Private). Смена типов сетей для Windows 7 и Windows 8 (нужно включить общие папки и принтеры для частной сети):</p>
<p><img alt="" src="http://fs.exonix.ru/network/LAN/lan3.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p><img height="768" width="1024" alt="lan3.png" src="1665329145095.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: center;"><img height="768" width="1024" alt="lan4.png" src="1665329145097.png"></p>
<p><img alt="" src="http://fs.exonix.ru/network/LAN/lan4.png" style="display: block; margin-left: auto; margin-right: auto;"></p>
<p style="text-align: justify;">&nbsp;Рассмотрим как работает локальная сеть без доступа в интернет: у компьютеров не будет настроен шлюз по умолчанию и ДНС. Моей рабочей станцией будет Windows 8. Я хочу обратиться к компьютеру <strong>debian7-1</strong>, для этого я в командной строке выполню следующую команду:</p>
<pre>C:\Users\admin&gt;ping&nbsp;<strong>debian7-1</strong><br>Ping request could not find host&nbsp;<span>debian7-1</span>. Please check the name and try again.</pre>
<p>&nbsp;Однако, мой компьютер не знает имени&nbsp;<span>debian7-1</span>, о чём нам и сообщает результат команды ping. Теперь попробуем обратится к компьютеру по его IP адресу.</p>
<pre>C:\Users\admin&gt;ping 10.10.10.50 <br> <br>Pinging 10.10.10.50 with 32 bytes of data: <br>Reply from 10.10.10.50: bytes=32 time&lt;1ms TTL=<span style="color: #ff0000;"><strong>64</strong></span> <br>Reply from 10.10.10.50: bytes=32 time&lt;1ms TTL=<span style="color: #ff0000;"><strong>64</strong></span><br>Reply from 10.10.10.50: bytes=32 time&lt;1ms TTL=<span style="color: #ff0000;"><strong>64</strong></span><br>Reply from 10.10.10.50: bytes=32 time&lt;1ms TTL=<span style="color: #ff0000;"><strong>64</strong></span><br> <br>Ping statistics for 10.10.10.50: <br> Packets: Sent = 4, Received = 4, Lost = 0 (0% loss), <br>Approximate round trip times in milli-seconds: <br> Minimum = 0ms, Maximum = 0ms, Average = 0ms</pre>
<p>&nbsp;Сеть между Debian и Windows работает, но не по имени, а только по IP. А теперь я обращусь по имени к компьютеру с именем <strong>WIN7</strong>:</p>
<pre>C:\Users\admin&gt;ping <strong>win7</strong> <br> <br>Pinging 10.10.10.200 with 32 bytes of data: <br>Reply from 10.10.10.200: bytes=32 time&lt;1ms TTL=<span style="color: #ff0000;"><strong>128</strong></span> <br>Reply from 10.10.10.200: bytes=32 time&lt;1ms TTL=<span style="color: #ff0000;"><strong>128</strong></span> <br>Reply from 10.10.10.200: bytes=32 time&lt;1ms TTL=<span style="color: #ff0000;"><strong>128</strong></span> <br>Reply from 10.10.10.200: bytes=32 time&lt;1ms TTL=<span style="color: #ff0000;"><strong>128</strong></span> <br> <br>Ping statistics for 10.10.10.200: <br> Packets: Sent = 4, Received = 4, Lost = 0 (0% loss), <br>Approximate round trip times in milli-seconds: <br> Minimum = 0ms, Maximum = 0ms, Average = 0ms</pre>
<p style="text-align: justify;">&nbsp;Я редко настраиваю сети для дома без DNS сервера (хотя бы DNS в роутере), а в организациях тем более. По этому для меня было в новинку увидеть разрешение имён компьютеров без настройки DNS или файла hosts. Если честно, я даже не смог сформулировать поисковый запрос в гугл, чтобы узнать в чём дело. Но знающие люди подсказали&nbsp;<a target="_blank" rel="noopener" href="http://www.ietf.org/rfc/rfc4795.txt">Link-Local Multicast Name Resolution (LLMNR)</a>. Поддерживается только с Windows Vista и выше.&nbsp;<span>Во время ping красным цветом я выделил значения&nbsp;</span><a target="_blank" rel="noopener" href="http://ru.wikipedia.org/wiki/Time_to_live">TTL</a><span>. По данному значению можно определить установленную ОС: 128 - Windows, 64 - Linux, 54 - FreeBSD, 255 - Cisco IOS 12 версии.</span></p>
<p style="text-align: justify;">&nbsp;В данном примере был упомянут файл hosts. В Windows он находится по пути&nbsp;<em>C:\Windows\System32\drivers\etc\hosts</em>. В Linux операционных системах по пути /etc/hosts. Заполняется он одинаково для обеих ОС, хотя и выглядит немного по разному. Для того, чтобы с компьютера с Debian я мог обратится по имени к компьютеру WIN7 или WIN8, я должен сделать соответствующие записи в данный файл. Для разрешения имён за пределами локальной сети можно так же использовать данный файл. LLMNR&nbsp;работает только в пределах одного сегмента. Ещё одной особенностью протокола LLMNR является то, что он хоть и разрешает имена в IP адреса, но этого недостачно для доступа в общую папку на другом компьютере, по этому настройка файла hosts для доступа к ресурсам обязательна. Для того, что бы редактировать файл hosts блокнот должен быть открыть от имени администратора и текстовый редактор в Debian от имени root. Вот вид файла hosts по умолчанию для Windows и Debian с правками:</p>
<pre># Copyright (c) 1993-2009 Microsoft Corp. <br># <br># This is a sample HOSTS file used by Microsoft TCP/IP for Windows. <br># <br># This file contains the mappings of IP addresses to host names. Each <br># entry should be kept on an individual line. The IP address should <br># be placed in the first column followed by the corresponding host name. <br># The IP address and the host name should be separated by at least one <br># space. <br># <br># Additionally, comments (such as these) may be inserted on individual <br># lines or following the machine name denoted by a '#' symbol. <br># <br># For example: <br># <br># 102.54.94.97 rhino.acme.com # source server <br># 38.25.63.10 x.acme.com # x client host <br> <br># localhost name resolution is handled within DNS itself. <br># 127.0.0.1 localhost <br># ::1 localhost</pre>
<pre>127.0.0.1 localhost <br>127.0.1.1 debian7-1.domain.tld debian7-1<br> <br># The following lines are desirable for IPv6 capable hosts <br>::1 ip6-localhost ip6-loopback <br>fe00::0 ip6-localnet <br>ff00::0 ip6-mcastprefix <br>ff02::1 ip6-allnodes <br>ff02::2 ip6-allrouters <br><br><strong>10.10.10.200 win7</strong><br><strong>10.10.10.100 win8</strong></pre>
<p style="text-align: justify;">&nbsp; Для того, чтобы лучше понять работу локальной сети, можно рассмотреть, что происходит с IP пакетом на пути следования от сетевой карты до сетевой карты. <a target="_blank" rel="noopener" href="http://ru.wikipedia.org/wiki/IPv4">Структура IP пакета</a>&nbsp;содержит несколько полей. Нас будут интересовать только два поля: адрес источника и адрес назначения. В нашем случае адрес источника это 10.10.10.100, адрес назначения для Win7 - 10.10.10.200, для Debian7-1 - 10.10.10.50. Адрес источника нужен будет для того, чтобы получатель знал кому отвечать. Однако сетевая карта понятия не имеет где находится адрес назначения 10.10.10.200 или 10.10.10.50. На помощь ей приходит протокол <a target="_blank" rel="noopener" href="https://ru.wikipedia.org/wiki/ARP">ARP</a>&nbsp;(<a target="_blank" rel="noopener" href="https://ru.wikipedia.org/wiki/Neighbor_Discovery_Protocol">NDP</a> для IPv6). В самом начале выполняется Broadcast запрос ARP на IP адресс 10.10.10.255 (данный адрес определён в таблице маршрутизации) на предмет "Кому принадлежит IP адрес 10.10.10.200 и какой у тебя MAC адрес?". Нам ответит только тот узел, который имеет запрашиваемый адрес. Остальные проигнорируют этот запрос. Напомню, что Broadcast сообщение, это сообщение всем сетевым устройствам в сети, количество которых определяется <strong>сетевой маской</strong>. У нас сеть 10.10.10.0/24 - 253 узла (минус номер сети и адрес broadcast). Если у нас сеть была бы 10.10.10.96/29, то первый рабочий адрес <span>(который можно назначить сетевой карте)</span>&nbsp;был бы 10.10.<strong>10.97</strong>, а последний - 10.10.<strong>10.102</strong>. В таком случае, ни Win7 (10.200), ни Debian7-1 (10.50) не получили бы широковещатьеный запрос, так как они вне этой сети, и, соответственно, не ответят нам. После того, как ARP запрос был выполнен и получен ответ, то создаётся таблица ARP:</p>
<pre style="text-align: justify;">C:\Users\admin&gt;arp -a
Interface: 10.10.10.100 --- 0x10
&nbsp; Internet Address &nbsp; &nbsp; &nbsp;Physical Address &nbsp; &nbsp; &nbsp;Type
&nbsp; 10.10.10.50 &nbsp; &nbsp; &nbsp; &nbsp; 00-25-90-05-e1-4b &nbsp; &nbsp; dynamic
&nbsp; 10.10.10.200 &nbsp; &nbsp; &nbsp; &nbsp;00-15-5d-0a-01-00 &nbsp; &nbsp; dynamic
</pre>
<pre>root@debian7-1:~# arp -a <br>win7 (10.10.10.200) at 00-15-5d-0a-01-00 [ether] on eth0 <br>win8 (10.10.10.100) at 00:25:90:71:b4:94 [ether] on eth0</pre>
<p style="text-align: justify;">&nbsp;Все динамические записи имеют определённое время жизни, около 2 минут до следующего продления. Между нашими компьютерами установлен коммутатор, у которого тоже есть своя таблица ARP для того, чтобы знать через какой интерфейс отправлять данные, адресованные этому IP c его MAC адресом. Таблица ARP с коммутатора Cisco 3750 c IOS 12 версии:</p>
<pre>cisco3750.1#sh arp
Protocol &nbsp;Address &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Age (min) &nbsp;Hardware Addr &nbsp; Type &nbsp; Interface
Internet &nbsp;10.10.10.10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 198 &nbsp; 0001.6456.f400 &nbsp;ARPA &nbsp; Vlan25
Internet &nbsp;10.10.10.50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; 0025.9005.e14b &nbsp;ARPA &nbsp; Vlan25
Internet &nbsp;10.10.10.100&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3 &nbsp; 0025.9071.b494&nbsp; ARPA &nbsp; Vlan25<br>Internet &nbsp;10.10.10.200 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; 0015.5d0a.0100 &nbsp;ARPA &nbsp; Vlan25</pre>
<pre>cisco3750.1#sh mac-address-table
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Mac Address Table
-------------------------------------------
Vlan &nbsp; &nbsp;Mac Address &nbsp; &nbsp; &nbsp; Type &nbsp; &nbsp; &nbsp; &nbsp;Ports
---- &nbsp; &nbsp;----------- &nbsp; &nbsp; &nbsp; -------- &nbsp; &nbsp;-----
&nbsp;All &nbsp; &nbsp;0100.0ccc.cccc &nbsp; &nbsp;STATIC &nbsp; &nbsp; &nbsp;CPU
&nbsp; 50 &nbsp; &nbsp;0025.9005.e14b &nbsp; &nbsp;DYNAMIC &nbsp; &nbsp; Fa1/0/1
&nbsp; 50 &nbsp; &nbsp;0001.6456.f400 &nbsp; &nbsp;DYNAMIC &nbsp; &nbsp; Gi1/0/1
&nbsp; 50 &nbsp; &nbsp;0025.9071.b494 &nbsp; &nbsp;DYNAMIC &nbsp; &nbsp; Fa1/0/2
&nbsp; 50 &nbsp; &nbsp;0015.5d0a.0100 &nbsp; &nbsp;DYNAMIC &nbsp; &nbsp; Fa1/0/3
</pre>
<p style="text-align: justify;"><strong>&nbsp;</strong>На этом всё, пакет знает IP адрес получателя, сетевая карта знает его MAC адрес, коммутатор знает соответствие МАС адреса и порта, имена разрешаются или через файл hosts, или через службу DNS<span>&nbsp;- всё готово для сетевого общения!</span></p>
<p style="text-align: left;"><strong>Резюме:<br></strong>- для соединения компьютеров напрямую используют кроссовый патч-корд.<br>- для <span>соединения&nbsp;</span>компьютеров через коммутаторы можно использовать любой патч-корд, если коммутатор поддерживает автоопределение <span>MDIX</span>.<br>- для работы локальной сети со смешанными ОС необходимо вручную назначить IP адреса и сетевую маску.<br>- IP адреса, MAC адреса должны быть уникальными во избежании конфликтов (исключение multicast).<br>- для работы локальных сетей Windows необходимо проверить настройки сетевых профилей.<br>- для использования имён компьютеров необходимо внести записи с именами и соотвтествующим им IP адреса в файл hosts или использовать DNS.</p>
<p style="text-align: right;"><em>03.07.2013</em></p>
<p>&nbsp;</p>
<p style="text-align: justify;">&nbsp;</p>
<div id="vk_comments"></div>