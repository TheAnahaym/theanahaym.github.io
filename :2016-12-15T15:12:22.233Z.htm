<!DOCTYPE html>
<html>
<head>
</head>
<body>
<p style="text-align: center;"><strong>Установка MS SQL 2016 на Debian <span style="color: #ff0000;">8.6</span> x64</strong></p>
<p style="text-align: justify;">&nbsp; MS SQL 2016 презентован 1 июня 2016. Одним из самых значимых&nbsp;нововведением данного выпуска является то, что MS SQL 2016 можно установить на Linux, пусть пока и не RTM-версию. Официальное название MS SQL - SQL Server&nbsp;<span>vNext CTP1.</span>&nbsp;На момент написания статьи официально MS SQL можно установить на <a href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-setup" target="_blank" rel="noopener noreferrer">Red Hat и Ubuntu</a> (а так же в контейнер Docker). Но так как я в своей работе в основном использую Debian, то эта статья и будет посвящена установке на Debian, на котором основана Ubuntu. Главное различие (для MS SQL) в том, что стабильный Denian 8.6 использует ядро 3.16, в то время как стабильная Ubuntu 16.04 использует ядро 4.4. Debian 9 будет использовать ядро 4.8 и я ожидаю, что именно Debian 9 будет заявлен для поддержки установки MS SQL. И так установка на Debain 8.6 c ядром <strong><span style="color: #ff0000;">3.16 </span></strong><span style="color: #ff0000;"></span><strong>(</strong>в конце статьи<strong>&nbsp;</strong>будет для <a href="/Статьи/Unix-Linux/Обновление_ядра/">обновлённого ядра</a><strong><span style="color: #ff0000;"> 4.7</span>)</strong>:</p>
<p>&nbsp;Исходные данные:<br />&nbsp;- виртуальная машина на Proxmox&nbsp;4.2-15:<br />Intel(R) Xeon(R) CPU E5-2470 v2 @ 2.40GHz<br />MemTotal: 5095 MB<br />Disk /dev/vda: 128 GiB,<br />Description: Debian GNU/Linux 8.6 (jessie)<br />Linux <span style="color: #ff0000;"><strong>3.16.0-4</strong></span>-amd64 x86_64</p>
<p style="text-align: justify;">&nbsp;Для начала необходимо подготовить систему для установки пакетов и зависимостей. Т.к. официально пакета MS SQL для Debian нет, то будем использовать репозиторий от Ubuntu. Все действия производятся от пользователя <strong>root</strong>, в противном случае команды запускаются через sudo (как описано в <a href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-setup-ubuntu" target="_blank" rel="noopener noreferrer">официальной документации</a> по установке MS SQL на Linux Ubuntu)</p>
<pre>echo "deb http://de.archive.ubuntu.com/ubuntu xenial main" &gt;&gt; /etc/apt/sources.list<br />echo "deb http://ftp.de.debian.org/debian jessie-backports main" &gt;&gt; /etc/apt/sources.list<br />apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 3B4FE6ACC0B21F32 40976EAF437D05B5</pre>
<p>&nbsp;Установим минимальные инструменты и зависимости для успешной установки MS SQL:</p>
<pre>aptitude install curl apt-transport-https sudo</pre>
<p style="text-align: justify;">&nbsp;Установка именно нужных версий является главной сложностью в установке MS SQL. Так, например, после обновления до самой последней (нестабильной) версии openSSL из репозитория Debian SID, установщик MS SQL заругается, что openSSL слишком новый:</p>
<pre><span>  mssql-server : Depends: openssl (&lt;= 1.1.0) but 1.1.0c-2 is installed.</span></pre>
<p>&nbsp;Добавляем репозиторий Microsoft:</p>
<pre>curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -<br />curl https://packages.microsoft.com/config/ubuntu/16.04/mssql-server.list | tee /etc/apt/sources.list.d/mssql-server.list</pre>
<p>&nbsp;Можно также добавить репозиторий и для инструментов MS SQL, но у меня пока не получилось их установить из-за большого количества зависимостей...</p>
<pre>curl https://packages.microsoft.com/config/ubuntu/16.04/prod.list | tee /etc/apt/sources.list.d/msprod.list</pre>
<p>&nbsp;Обновляем список пактов:</p>
<pre>aptitude update</pre>
<p>&nbsp;Обновляем первый пакет OpenSSL: нужно три раза ответить <strong>N</strong>, и один раз <strong>Y</strong>. Ибо первые три предложенных решения не предлагают обновить OpenSSL:</p>
<pre>aptitude install libssl-dev=1.0.2j-1~bpo8+1<br /><br /><strong>Keep</strong> the following packages at their current version:<br />1) libssl-dev [Not Installed]<br />Accept this solution? [Y/n/q/?] <strong>n</strong><br /><br /><strong>Install</strong> the following packages:<br />1) libssl-dev [<strong>1.0.1t</strong>-1+deb8u5 (stable)]<br />Accept this solution? [Y/n/q/?] <strong>n</strong><br /><br />The following actions will resolve these dependencies:<br /> <strong>Install</strong> the following packages:<br />1) libssl-dev [<strong>1.0.1t</strong>-1+deb8u3 (stable)]<br /> <strong>Downgrade</strong> the following packages:<br />2) libssl1.0.0 [<strong>1.0.1t</strong>-1+deb8u5 (now, stable) -&gt; 1.0.1t-1+<strong>deb8u3</strong> (stable)]<br />Accept this solution? [Y/n/q/?] <strong>n</strong><br /><br />The following actions will resolve these dependencies:<br /> <strong>Upgrade</strong> the following packages:<br />1) libssl1.0.0 [1.0.1t-1+deb8u5 (now, stable) -&gt; <strong>1.0.2j</strong>-1~bpo8+1 (jessie-backports)]<br />Accept this solution? [Y/n/q/?] <strong>Y</strong></pre>
<p>&nbsp;Но на самом деле это ещё не всё, даже если версия кажется обновлённой:</p>
<pre>  openssl version<br />  OpenSSL 1.0.1t 3 May 2016 (Library: OpenSSL 1.0.2j 26 Sep 2016)</pre>
<p>&nbsp;Устанавливаем MS SQL, где так же на первое решение отвечаем <strong>N</strong>, и только потом <strong>Y</strong>. Таким способом и закончится обновление OpenSSL:</p>
<pre>aptitude install mssql-server<br /><br />The following packages have unmet dependencies:<br /> mssql-server : Depends: openssl (&gt;= 1.0.2) but 1.0.1t-1+deb8u5 is installed.<br />The following actions will resolve these dependencies:<br /><br /><strong>Keep</strong> the following packages at their current version:<br />1) mssql-server [<strong>Not Installed</strong>]<br />Accept this solution? [Y/n/q/?] <strong>n</strong><br /><br />The following actions will resolve these dependencies:<br /> <strong>Upgrade</strong> the following packages:<br />1) openssl [1.0.1t-1+deb8u5 (now, stable) -&gt; <strong>1.0.2j</strong>-1~bpo8+1 (jessie-backports)]<br />Accept this solution? [Y/n/q/?] <strong>Y</strong><br /><br />Get: 9 http://ftp.de.debian.org/debian/ jessie/main libc6-dbg amd64 2.19-18+deb8u6 [3,431 kB]<br />28% [3 mssql-server 34.3 MB/144 MB 24%] 1,850 kB/s 59s<br /><br />Setting up mssql-server (14.0.1.246-6) ...<br />+-------------------------------------------------------------------+<br />| Please run /opt/mssql/bin/sqlservr-setup to complete the setup of |<br />| Microsoft(R) SQL Server(R). |<br />+-------------------------------------------------------------------+<br />Processing triggers for libc-bin (2.19-18+deb8u6) ...<br />Current status: 0 updates [-1].</pre>
<p style="text-align: justify;">&nbsp;Запускаем конфигуратор начальной установки (утилита SUDO <strong>должна</strong> быть установлена, даже если установка происходит как у меня от <strong>root</strong>), который предложит принять лицензионное соглашение и ввести пароль для SA (минимум <strong>8</strong> знаков), запустить демон, настроить демон на автостарт при старте системы:</p>
<pre>/opt/mssql/bin/sqlservr-setup<br /><br />Microsoft(R) SQL Server(R) Setup<br /><br />You can abort setup at anytime by pressing Ctrl-C. Start this program<br />with the --help option for information about running it in unattended mode.<br /><br />The license terms for this product can be downloaded from<br />http://go.microsoft.com/fwlink/?LinkId=746388 and found<br />in /usr/share/doc/mssql-server/LICENSE.TXT.<br /><br />Do you accept the license terms? If so, please type "YES": YES<br /><br />Please enter a password for the system administrator (SA) account:<br />Please confirm the password for the system administrator (SA) account:<br /><br />Setting system administrator (SA) account password...<br /><br />Do you wish to start the SQL Server service now? [y/n]: y<br />Do you wish to enable SQL Server to start on boot? [y/n]: y<br />Created symlink from /etc/systemd/system/multi-user.target.wants/mssql-server.service to /lib/systemd/system/mssql-server.service.<br />Created symlink from /etc/systemd/system/multi-user.target.wants/mssql-server-telemetry.service to /lib/systemd/system/mssql-server-telemetry.service.<br /><br />Setup completed successfully.</pre>
<p>&nbsp;Перезагружаем сервер и проверяем работу MS SQL:</p>
<pre>ps aux | grep sql<br />mssql 453 0.0 0.3 58048 16016 ? Ssl 15:40 0:00 /opt/mssql/bin/sqlservr<br />mssql 455 0.0 0.4 114696 21388 ? Ssl 15:40 0:00 /opt/mssql/bin/sqlservr-telemetry /var/opt/mssql/.system<br />mssql 734 1.4 12.1 2885848 619072 ? Sl 15:40 1:34 /opt/mssql/bin/sqlservr<br />root 2060 0.0 0.0 12932 972 pts/0 S+ 17:28 0:00 grep sql</pre>
<p>&nbsp;Подключаемся к MS SQL из <a href="https://msdn.microsoft.com/en-us/library/mt238290.aspx" target="_blank" rel="noopener noreferrer">SQL Server Management Studio</a>&nbsp;16:</p>
<p><img src="http://fs.exonix.ru/SQL/MS2016/mssql1.png" alt="" width="477" height="314" caption="false" class="" style="display: block; margin-left: auto; margin-right: auto;" /></p>
<p style="text-align: right;"><img src="http://fs.exonix.ru/SQL/MS2016/mssql2.png" alt="" width="563" height="401" caption="false" class="" style="display: block; margin-left: auto; margin-right: auto;" /></p>
<p style="text-align: right;"><em>Installation of MS SQL 2016 on Linux Debian 8.6 x64 kernel <span style="color: #ff0000;"><strong>3.16</strong></span></em></p>
<p style="text-align: right;"><em>Installation von MS SQL 2016 auf dem Linux Debian 8.6 x64 kernel <span style="color: #ff0000;"><strong>3.16</strong></span></em></p>
<p style="text-align: right;"><em><strong>15.12.2016</strong></em></p>
<p></p>
<p>&nbsp;Для <a href="/Статьи/Unix-Linux/Обновление_ядра/">Debian 8.6 x64 с ядром <span style="color: #ff0000;"><strong>4.7</strong></span></a>.</p>
<p>&nbsp;Исходные данные:<br />&nbsp;- виртуальная машина на Proxmox&nbsp;4.2-15:<br />Intel(R) Xeon(R) CPU E5-2470 v2 @ 2.40GHz<br />MemTotal: 5095 MB<br />Disk /dev/vda: 128 GiB,<br />Description: Debian GNU/Linux 8.6 (jessie)<br />Linux <span style="color: #ff0000;"><strong>4.7.0</strong></span>-0.bpo.1-amd64 x86_64</p>
<p>&nbsp;После обновления ядра версия OpenSSL станет удовлетворять требованиям MS SQL 2016:</p>
<pre>  openssl version<br />  OpenSSL 1.0.2g-fips 1 Mar 2016</pre>
<p>&nbsp;Установка MS SQL 2016:</p>
<pre>curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -<br />curl https://packages.microsoft.com/config/ubuntu/16.04/mssql-server.list | tee /etc/apt/sources.list.d/mssql-server.list<br />curl https://packages.microsoft.com/config/ubuntu/16.04/prod.list | tee /etc/apt/sources.list.d/msprod.list<br />aptitude update<br />aptitude install curl apt-transport-https sudo</pre>
<pre><span style="color: #ff0000;">aptitude install mssql-server</span><br />&nbsp; The following NEW packages will be installed:<br />&nbsp; gcc-5-base{a} gdb{a} gdbserver{a} libbabeltrace-ctf1{a} libbabeltrace1{a} libc++1{a} libc6-dbg{a} libcc1-0{a} libjemalloc1{a} libmpdec2{a}<br />&nbsp; libpython3.5{a} libpython3.5-minimal{a} libpython3.5-stdlib{a} libunwind8{a} mssql-server<br />&nbsp; The following packages will be upgraded:<br />&nbsp; libc-bin libc6 libncurses5 libncursesw5 libssl1.0.0 libstdc++6 libtinfo5 locales openssl<br />&nbsp; 9 packages upgraded, 15 newly installed, 0 to remove and 299 not upgraded.<br />&nbsp; Need to get 164 MB of archives. After unpacking 736 MB will be used.<br />&nbsp; Do you want to continue? [Y/n/?] Y<br /><br />&nbsp; 33% [4 mssql-server 35.0 MB/145 MB 24%] 1,175 kB/s 1min 33s<br />&nbsp; Selecting previously unselected package mssql-server.<br />&nbsp; Preparing to unpack .../mssql-server_14.0.100.187-1_amd64.deb ...<br />&nbsp; Unpacking mssql-server (14.0.100.187-1) ...<br />&nbsp; Setting up mssql-server (14.0.100.187-1) ...<br /><br />+-------------------------------------------------------------------+<br />| Please run /opt/mssql/bin/sqlservr-setup to complete the setup of |<br />| Microsoft(R) SQL Server(R). |<br />+-------------------------------------------------------------------+<br /><br />&nbsp; Processing triggers for libc-bin (2.23-0ubuntu3) ...<br /><br />&nbsp; Current status: 299 updates [-9].<span style="color: #ff0000;"><strong><br /></strong></span></pre>
<pre><span style="color: #ff0000;"><strong>/opt/mssql/bin/sqlservr-setup</strong></span><br />&nbsp; Microsoft(R) SQL Server(R) Setup<br /><br />&nbsp; You can abort setup at anytime by pressing Ctrl-C. Start this program<br />&nbsp; with the --help option for information about running it in unattendedmode.<br /><br />&nbsp; The license terms for this product can be downloaded from<br />&nbsp; http://go.microsoft.com/fwlink/?LinkId=746388 and found<br />&nbsp; in /usr/share/doc/mssql-server/LICENSE.TXT.<br /><br />Do you accept the license terms? If so, please type "YES": <span style="color: #ff0000;"><strong>YES</strong></span><br /><br />Please enter a password for the system administrator (SA) account:<br />Please confirm the password for the system administrator (SA) account:<br /><br />Setting system administrator (SA) account password...<br /><br />Do you wish to start the SQL Server service now? [y/n]: <span style="color: #ff0000;"><strong>y</strong></span><br />Do you wish to enable SQL Server to start on boot? [y/n]: <span style="color: #ff0000;"><strong>y</strong></span><br />Created symlink from /etc/systemd/system/multi-user.target.wants/mssql-server.service to /lib/systemd/system/mssql-server.service.<br />Created symlink from /etc/systemd/system/multi-user.target.wants/mssql-server-telemetry.service to /lib/systemd/system/mssql-server-telemetry.service.<br /><br />Setup completed successfully.</pre>
<p>При этом, стоит отметить, что установилась более новая версия MS SQL 2016:</p>
<p><img src="http://fs.exonix.ru/SQL/MS2016/mssql3.png" alt="" width="557" height="324" caption="false" class="" style="display: block; margin-left: auto; margin-right: auto;" /></p>
<pre>aptitude versions mssql-server<br />Package mssql-server:<br />p 14.0.1.246-6   xenial   500<br /><strong><span style="color: #ff0000;">i 14.0.100.187-1 xenial   500</span></strong></pre>
<p>&nbsp;Так же можно проверить подключение из PowerShell двумя вариантами. Для выполнения Invoke-sqlcmd на компьютере должен быть установлен <a href="https://msdn.microsoft.com/en-us/library/mt238290.aspx" target="_blank" rel="noopener noreferrer">SSMS</a>:</p>
<pre>Invoke-Sqlcmd -Query "SELECT name, database_id, create_date FROM sys.databases;" -ServerInstance "192.168.0.1" -Username SA -Password <span style="color: #ff0000;">********</span></pre>
<pre>$SQLServer = "<span>192.168.0.1</span>"<br />$uid ="SA"<br />$pwd = "<span style="color: #ff0000;">*******</span><span><span style="color: #ff0000;">*</span>"</span><br />$SqlQuery = "SELECT name, database_id, create_date FROM sys.databases;"<br />$SqlConnection = New-Object System.Data.SqlClient.SqlConnection<br />$SqlConnection.ConnectionString = "Server = $SQLServer; User ID = $uid; Password = $pwd;"<br />$SqlCmd = New-Object System.Data.SqlClient.SqlCommand<br />$SqlCmd.CommandText = $SqlQuery<br />$SqlCmd.Connection = $SqlConnection<br />$SqlAdapter = New-Object System.Data.SqlClient.SqlDataAdapter<br />$SqlAdapter.SelectCommand = $SqlCmd<br />$DataSet = New-Object System.Data.DataSet<br />$SqlAdapter.Fill($DataSet)<br /><br />$DataSet.Tables[0]</pre>
<p>&nbsp;Вывод:</p>
<pre>name database_id create_date <br />---- ----------- ----------- <br />master 1 08.04.2003 09:13:36<br />tempdb 2 17.12.2016 12:25:44<br />model  3 08.04.2003 09:13:36<br />msdb   4 10.12.2016 04:10:15</pre>
<p style="text-align: right;"><br /><em>Installation of MS SQL 2016 on Linux Debian 8.6 x64 kernel <span style="color: #ff0000;"><strong>4.7</strong></span></em></p>
<p style="text-align: right;"><em>Installation von MS SQL 2016 auf dem Linux Debian 8.6 x64 kernel <span style="color: #ff0000;"><strong>4.7</strong></span></em></p>
<p style="text-align: right;"><em><strong>16.12.2016</strong><span style="color: #ff0000;"><strong><br /></strong></span></em></p>
<div id="vk_comments"></div>
<div id="fb-root"></div>
<script>// <![CDATA[
(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v2.8";
  fjs.parentNode.insertBefore(js, fjs);
 }(document, 'script', 'facebook-jssdk'));
// ]]></script>
<div class="fb-comments" data-href="http://exonix.ru/#!Статьи/MS_SQL/MS_SQL_2016_on_Debian/" data-width="670" data-numposts="20"></div>
</body>
</html>