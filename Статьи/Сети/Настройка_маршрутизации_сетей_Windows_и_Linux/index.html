<!DOCTYPE html><html><head><meta property="og:type" content="website"><meta property="twitter:card" content="summary_large_image"><title>Настройка маршрутизации сетей Windows и Linux</title><meta name="title" content="Настройка маршрутизации сетей Windows и Linux"><meta property="og:title" content="Настройка маршрутизации сетей Windows и Linux"><meta property="twitter:title" content="Настройка маршрутизации сетей Windows и Linux"><link rel="canonical" href="https://exonix.ru/%D0%A1%D1%82%D0%B0%D1%82%D1%8C%D0%B8/%D0%A1%D0%B5%D1%82%D0%B8/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8_%D1%81%D0%B5%D1%82%D0%B5%D0%B9_Windows_%D0%B8_Linux/"/><meta property="og:url" content="https://exonix.ru/%D0%A1%D1%82%D0%B0%D1%82%D1%8C%D0%B8/%D0%A1%D0%B5%D1%82%D0%B8/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8_%D1%81%D0%B5%D1%82%D0%B5%D0%B9_Windows_%D0%B8_Linux/"><meta property="twitter:url" content="https://exonix.ru/%D0%A1%D1%82%D0%B0%D1%82%D1%8C%D0%B8/%D0%A1%D0%B5%D1%82%D0%B8/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8_%D1%81%D0%B5%D1%82%D0%B5%D0%B9_Windows_%D0%B8_Linux/"><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym("55256677","init",{clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><base href="/us-east-1:df521432-f688-4bb9-baa9-add1ace190c1/"><link rel="icon" href="/us-east-1:df521432-f688-4bb9-baa9-add1ace190c1.ico" type="image/vnd.microsoft.icon"><script async src="//cdn.redaktr.com/redaktr.min.js"></script><link rel="stylesheet" href="https://cdn.redaktr.com/redaktr.cdn.min.css"><link rel="stylesheet" href="https://cdn.redaktr.com/redaktr.min.css"></head><body><div class="ui sidebar very wide vertical accordion menu"></div><div class="ui main menu fixed" hidden><a class="launch icon item"><i class="content icon"></i></a><div class="header item">Настройка маршрутизации сетей Windows и Linux</div></div><div class="pusher"><div data-absolute="" class="ui fluid container" style="z-index: 8;"><div id="menu" class="" style="align-self: center; margin-top: 503px; border-style: none; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-position: 0% 0%; background-repeat: repeat; background-attachment: scroll; background-size: auto;" data-scrollable="true" data-popup-collision="true" data-orientation="horizontal" data-open-on-click="false" data-hover-delay="100" data-direction="default" data-close-on-click="true" data-animation="true" data-icons="true" data-menu-icons="false" data-id="rmenu"></div></div><div data-static="" class="ui container" style="z-index: 7;"><div id="content" style="margin: 558px 4px 200px; min-height: 600px; flex: 1 1 auto; padding: 20px; border-width: 2px; border-style: double; border-color: rgb(204, 204, 204); color: rgb(102, 102, 102); opacity: 1; background-repeat: repeat; background-attachment: scroll;" class="well" data-turbomenu="false"><main><div><ul class="dropdown" data-jkit="[menu]"><li><a href="#!Статьи.Сети.Настройка_маршрутизации_сетей_Windows_и_Linux">Настройка маршрутизации сетей Windows и Linux</a><ul class="sub_menu"><li><a href="#!Статьи.Сети.Маршрутизатор_2012_R2">Маршрутизатор 2012 R2</a></li><li><a href="#!Статьи.Сети.Локальная_сеть_IPv4">Локальная сеть IPv4</a></li><li><a href="#!Статьи.Сети.Маршрутизация_сетей_IPv4">Маршрутизация сетей IPv4</a></li></ul></li></ul></div><p>&nbsp;</p><p>&nbsp;</p><p style="text-align: justify;">&nbsp;Routing and Remote Access - RRAS. Предоcтавляет сервисы маршрутизации сетей, VPN доступ, NAT, Dial-up доступ, Demand-dial соединения для филиалов. Мною используется в статье "<a href="http://www.exonix.ru/?ekxirklatv5gmlf8zvuphhw.htm">Доверительные отношения между 2008 R2 и 2012</a>".</p><p style="text-align: justify;">Так же маршрутизацию сетей можно реализовать сердствами Linux. напишу два метода, для сравнения создания маршрутизации. Начнём с Windows + RRAS:</p><pre>&nbsp;<span>Windows IP Configuration<br /></span>&nbsp;<span>&nbsp; Host Name . . . . . . . . . . . . : RRAS<br /></span><span>&nbsp; &nbsp;Primary Dns Suffix &nbsp;. . . . . . . :<br /></span><span>&nbsp; &nbsp;Node Type . . . . . . . . . . . . : Hybrid<br /></span><span>&nbsp; &nbsp;IP Routing Enabled. . . . . . . . : Yes<br /></span><span>&nbsp; &nbsp;WINS Proxy Enabled. . . . . . . . : No<br />&nbsp; &nbsp;DNS Suffix Search List. . . . . . :&nbsp;<br /></span><br />Ethernet adapter Local Area Connection 2:<br />&nbsp; &nbsp;Connection-specific DNS Suffix &nbsp;. :<br />&nbsp; &nbsp;Description . . . . . . . . . . . : Microsoft Virtual Machine Bus Network Adapter #2<br />&nbsp; &nbsp;Physical Address. . . . . . . . . : 00-15-5D-0A-13-0A<br />&nbsp; &nbsp;DHCP Enabled. . . . . . . . . . . : No<br />&nbsp; &nbsp;Autoconfiguration Enabled . . . . : Yes<br />&nbsp; &nbsp;Link-local IPv6 Address . . . . . : fe80::5467:641d:1be1:7ed1%13(Preferred)<br />&nbsp; &nbsp;IPv4 Address. . . . . . . . . . . :&nbsp;<strong>10.10.10.1</strong>(Preferred)<br />&nbsp; &nbsp;Subnet Mask . . . . . . . . . . . : 255.255.255.0<br />&nbsp; &nbsp;Default Gateway . . . . . . . . . :<br />&nbsp; &nbsp;DHCPv6 IAID . . . . . . . . . . . : 301995357<br />&nbsp; &nbsp;DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-18-33-D2-4E-00-15-5D-0A-13-0B<br />&nbsp; &nbsp;DNS Servers . . . . . . . . . . . : 10.10.10.100<br />&nbsp; &nbsp;NetBIOS over Tcpip. . . . . . . . : Enabled<br /><br />Ethernet adapter Local Area Connection:<br />&nbsp; &nbsp;Connection-specific DNS Suffix &nbsp;. :<br />&nbsp; &nbsp;Description . . . . . . . . . . . : Microsoft Virtual Machine Bus Network Adapter<br />&nbsp; &nbsp;Physical Address. . . . . . . . . : 00-15-5D-0A-13-0B<br />&nbsp; &nbsp;DHCP Enabled. . . . . . . . . . . : No<br />&nbsp; &nbsp;Autoconfiguration Enabled . . . . : Yes<br />&nbsp; &nbsp;Link-local IPv6 Address . . . . . : fe80::6d11:cb0e:d870:22f2%11(Preferred)<br />&nbsp; &nbsp;IPv4 Address. . . . . . . . . . . :&nbsp;<strong>172.16.16.1</strong>(Preferred)<br />&nbsp; &nbsp;Subnet Mask . . . . . . . . . . . : 255.255.255.0<br />&nbsp; &nbsp;Default Gateway . . . . . . . . . :<br />&nbsp; &nbsp;DHCPv6 IAID . . . . . . . . . . . : 234886493<br />&nbsp; &nbsp;DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-18-33-D2-4E-00-15-5D-0A-13-0B<br />&nbsp; &nbsp;DNS Servers . . . . . . . . . . . : 172.16.16.100<br />&nbsp; &nbsp;NetBIOS over Tcpip. . . . . . . . : Enabled</pre><p style="text-align: justify;">&nbsp;</p><p><img style="display: block; margin-left: auto; margin-right: auto;" src="http://fs.exonix.ru/network/rras1.png" alt="" width="512" height="376" /></p><p><img style="display: block; margin-left: auto; margin-right: auto;" src="http://fs.exonix.ru/network/rras2.png" alt="" width="500" height="423" /></p><p><img style="display: block; margin-left: auto; margin-right: auto;" src="http://fs.exonix.ru/network/rras3.png" alt="" width="500" height="423" /></p><p style="text-align: justify;">Теперь о настройке в Linux. Нужно просто выполнить команду:</p><pre style="text-align: justify;"><span>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></pre><p style="text-align: justify;">&nbsp;Во время создания доверий изначально я делал маршрутизацию не через RRAS. Изначально каждый гостевой сервер имел одну сетевую карту INTERNAL. Ею я мог управлять на хостовом сервере. Было сделано просто:</p><pre style="text-align: justify;">Ethernet adapter vEthernet (INTERNAL):<br />&nbsp;&nbsp; Connection-specific DNS Suffix &nbsp;. :<br />&nbsp; &nbsp;Link-local IPv6 Address . . . . . : fe80::deb:df1c:f386:4dfa%20<br />&nbsp; &nbsp;IPv4 Address. . . . . . . . . . . : 10.10.10.1<br />&nbsp; &nbsp;Subnet Mask . . . . . . . . . . . : 255.255.255.0<br />&nbsp; &nbsp;IPv4 Address. . . . . . . . . . . : 172.16.16.1<br />&nbsp; &nbsp;Subnet Mask . . . . . . . . . . . : 255.255.255.0<br />&nbsp; &nbsp;Default Gateway . . . . . . . . . :</pre><div>&nbsp;При данной кофигурации работали и ping и nslookup. И даже создавались внешние доверия, но по отдельности в каждом домене. При созаднии доверия в удалённом домене получал ошибку:</div><p style="text-align: justify;">- The operation failed. The error is: the directory datatype cannot be converted to/from a native DS datatype</p><div><img style="display: block; margin-left: auto; margin-right: auto;" src="http://fs.exonix.ru/resource/image/addt16.png" alt="" width="559" height="485" /></div><p style="text-align: justify;">При назначении прав получал следующие ошибки:<br />&nbsp;- Unable to lookup user names for display<br />&nbsp;- The Active Directory Domain Controllers requreid to find the selected objects in the following domain are not available</p><p><img style="display: block; margin-left: auto; margin-right: auto;" src="http://fs.exonix.ru/resource/image/addt15.png" alt="" /></p><p><img style="display: block; margin-left: auto; margin-right: auto;" src="http://fs.exonix.ru/resource/image/addt17.png" alt="" /></p><p style="text-align: right;"><em>24.10.2012</em></p><p style="text-align: justify;">&nbsp;</p><div id="vk_comments">&nbsp;</div></main></div></div><div data-absolute="" class="ui fluid container" style="z-index: 6;"><div id="roof-wrap1" style="min-width: 100%; align-self: center; margin-top: 0px; min-height: 483px; padding: 10px 0px 0px; border-width: 0px 0px 4px; border-style: none none solid; border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(246, 187, 36); color: rgb(102, 102, 102); opacity: 1; background-color: rgb(255, 255, 255); background-position: 0% 0%; background-repeat: repeat; background-attachment: scroll; background-size: auto; box-shadow: rgb(0, 0, 0) 0px 0px 2px 2px; background-image: url(&quot;1567075815596/sama2.png&quot;);" class=""><div id="roof1" data-jkit="[slideshow:interval=7000;speed=250;animation=fade]"><img src="files/roof/dresden.jpg"><img src="files/roof/moskau.jpg"><img src="1589641442742/berlin.jpg"></div></div></div><div data-absolute="" style="z-index: 5;"><div id="roof-wrap2" style="margin-left: 0px; margin-right: 0px; margin-top: 0px; min-height: 155px; padding: 10px 0px 0px; border-width: 0px 0px 4px; border-style: none none solid; border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(246, 187, 36); color: rgb(102, 102, 102); opacity: 1; background-color: rgb(255, 255, 255); background-position: 0% 0%; background-repeat: repeat; background-attachment: scroll; background-image: url(&quot;1567075817539/sama2.png&quot;);" class=""><div id="roof2"><img src="files/roof/site2.gif" width="100%"></div></div></div><div data-absolute="" class="ui container" style="z-index: 4;"><div class="" id="copyright" style="margin-left: 5px; min-width: 50px; align-self: center; margin-bottom: 148px; min-height: 38px; border-style: none; border-color: rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-repeat: repeat; background-attachment: scroll;"><p><a style="color: #6aa3b1;" href="//redaktr.com" target="_blank" title="Redaktr.com - твой бесплатный сайт в облаке! Начни redaktировать прямо сейчас!"><i style="text-shadow: 1px 1px 1px black;" class="fa fa-cloud-upload fa-3x"></i></a></p></div></div><div data-absolute="" class="ui container" style="z-index: 3;"><div class="" id="live-internet" style="margin-left: 70px; min-width: 88px; align-self: center; margin-bottom: 149px; min-height: 31px; border-style: none; border-color: rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-repeat: repeat; background-attachment: scroll;"><p><script>document.write("<a href='https://www.liveinternet.ru/click' " + "target=_blank><img src='https://counter.yadro.ru/hit?t13.12;r" + escape(document.referrer) + ((typeof(screen) == "undefined") ? "" : ";s" + screen.width + "*" + screen.height + "*" + (screen.colorDepth ? screen.colorDepth : screen.pixelDepth)) + ";u" + escape(document.URL) + ";" + Math.random() + "' alt='' title='LiveInternet: показано число просмотров за 24" + " часа, посетителей за 24 часа и за сегодня' " + "border='0' width='88' height='31'><\/a>")</script></p></div></div><div data-absolute="" style="z-index: 2;"><div id="main-footer" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px; min-height: 177px; border-style: none; border-color: rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-position: 50% 0px; background-repeat: no-repeat; background-attachment: scroll; background-image: url(&quot;1567149113516/motherboard.png&quot;);" class=""></div></div><div data-absolute="" style="z-index: 1;"><div id="wholebg" style="margin: 0px; flex: 1 1 auto; border-style: none; border-color: rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-position: 0% 0%; background-repeat: repeat; background-attachment: scroll; background-image: url(&quot;1567075817543/leather_1.png&quot;);" class=""></div></div></div></body></html>