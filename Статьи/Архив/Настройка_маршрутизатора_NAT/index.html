<!DOCTYPE html><html><head><meta property="og:type" content="website"><meta property="twitter:card" content="summary_large_image"><title>Настройка маршрутизатора NAT</title><meta name="title" content="Настройка маршрутизатора NAT"><meta property="og:title" content="Настройка маршрутизатора NAT"><meta property="twitter:title" content="Настройка маршрутизатора NAT"><link rel="canonical" href="https://exonix.ru/%D0%A1%D1%82%D0%B0%D1%82%D1%8C%D0%B8/%D0%90%D1%80%D1%85%D0%B8%D0%B2/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80%D0%B0_NAT/"/><meta property="og:url" content="https://exonix.ru/%D0%A1%D1%82%D0%B0%D1%82%D1%8C%D0%B8/%D0%90%D1%80%D1%85%D0%B8%D0%B2/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80%D0%B0_NAT/"><meta property="twitter:url" content="https://exonix.ru/%D0%A1%D1%82%D0%B0%D1%82%D1%8C%D0%B8/%D0%90%D1%80%D1%85%D0%B8%D0%B2/%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80%D0%B0_NAT/"><script>(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym");ym("55256677","init",{clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><base href="/us-east-1:df521432-f688-4bb9-baa9-add1ace190c1/"><link rel="icon" href="/us-east-1:df521432-f688-4bb9-baa9-add1ace190c1.ico" type="image/vnd.microsoft.icon"><script async src="//cdn.redaktr.com/redaktr.min.js"></script><link rel="stylesheet" href="https://cdn.redaktr.com/redaktr.cdn.min.css"><link rel="stylesheet" href="https://cdn.redaktr.com/redaktr.min.css"></head><body><div class="ui sidebar very wide vertical accordion menu"></div><div class="ui main menu fixed" hidden><a class="launch icon item"><i class="content icon"></i></a><div class="header item">Настройка маршрутизатора NAT</div></div><div class="pusher"><div data-absolute="" class="ui fluid container" style="z-index: 8;"><div id="menu" class="" style="align-self: center; margin-top: 503px; border-style: none; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(204, 204, 204) rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-position: 0% 0%; background-repeat: repeat; background-attachment: scroll; background-size: auto;" data-scrollable="true" data-popup-collision="true" data-orientation="horizontal" data-open-on-click="false" data-hover-delay="100" data-direction="default" data-close-on-click="true" data-animation="true" data-icons="true" data-menu-icons="false" data-id="rmenu"></div></div><div data-static="" class="ui container" style="z-index: 7;"><div id="content" style="margin: 558px 4px 200px; min-height: 600px; flex: 1 1 auto; padding: 20px; border-width: 2px; border-style: double; border-color: rgb(204, 204, 204); color: rgb(102, 102, 102); opacity: 1; background-repeat: repeat; background-attachment: scroll;" class="well" data-turbomenu="false"><main><p style="text-align: justify;">Старая статья. Моя самая первая )</p><p style="text-align: justify;"><span style="font-size: larger;" data-mce-mark="1">компиляция ядра</span></p><p style="text-align: justify;"><span style="font-size: larger;"># Идем в каталог с конфигурационными файлами ядра Если такого каталога нет, это значит, <br /> # что вы не установили kernel-development при инсталяции FreeBSD. Или проще - у вас нет исходных текстов ядра. <br /> # Для того, чтобы они появились на вашем жестком диске нужно установить пакет kernel-devel. <br /> # Обычно он находится на первом инсталяционном диске. <br /><br /> cd /usr/src/sys/i386/conf/ <br /> cp GENERIC GENERIC.old <br /> vi GENERIC <br /><br /> # Файл GENERIC - это та конфигурация ядра, которая была сделанная при инсталяции системы <br /> # Для того, чтобы включить в ядро поддержку ipfw и natd надо добавить в GENERIC вот такие строки: <br /><br /> options IPFIREWALL <br /> options IPFIREWALL_VERBOSE <br /> options IPFIREWALL_VERBOSE_LIMIT=10 <br /> options IPDIVERT <br /> options IPFIREWALL_DEFAULT_TO_ACCEPT <br /> options DUMMYNET <br /><br /> # Здесь IPFIREWALL означает включение программы файервола ipfw, <br /> # IPFIREWALL_VERBOSE означает ведение логов ipfw, <br /> # IPFIREWALL_VERBOSE_LIMIT=10 ограничичивает максимальное число записей, которые могут быть сделаны в секунду. <br /> # Учитывайте то, что если вы поставите большое число для IPFIREWALL_VERBOSE_LIMIT, то ваш винчестер может <br /> # засориться от быстрорастущих логов. <br /> # IPDIVERT означает включение демона маскарадинга natd, <br /> # IPFIREWALL_DEFAULT_TO_ACCEPT означает, что ваш файервол по дефолту будет открытым. <br /> # Если вы не указываете этой опции, то при старте файервола любой доступ из сети к компьютеру будет закрыт. <br /> # DUMMYNET означает, что вы сможете контролировать скорость передачи через ваш компьютер. <br /> # Теперь компилируем ядро <br /><br /> config GENERIC <br /> cd ../compile/GENERIC/ <br /> make depend <br /> make <br /> make install <br /><br /> # Если на каком-то шаге компиляции команда make depend или make выйдет, сказав вам об ошибке, то не расстраивайтесь, <br /> # а просто попробуйте перезапустить команду заново при этом приблизительно запомнив о чем говорилось в тексте ошибки. <br /> # Если после этого опять возникнет ошибка, то проверьте похожа ли она на предыдущую. В случае несовпадения смело <br /> # повторяйте последнюю команду. <br /><br /></span></p><p style="text-align: justify;"><span style="font-size: larger;">настройка сервиса маршрутизации и натирования адресов</span></p><p style="text-align: justify;"><span style="font-size: larger;"> # Скажем ядру, чтобы при старте он понимал, что этот компьютер - роутер. <br /><br /> cd /etc/ <br /> vi rc.conf <br /><br /> # Для этого надо отредактировать файл rc.conf в соответствии с приведенным ниже строками: <br /><br /> gateway_enable="YES" <br /> firewall_enable="YES" <br /> firewall_quiet="YES" <br /> firewall_type="OPEN" <br /> natd_enable="YES" <br /> natd_interface="rl0"<br /> natd_flags=""<br /> mysql_enable="YES" <br /><br /> # Я сразу включил базы данные, т.к. они нам понадобятся в дальнейшем. <br /> # К примеру, сетевая карта, которая подключена к интернету имеет название rl0 и ее ip-адрес в интернете 192.168.15.99, <br /> # а сетевая карта, которая подключена к локальной имеет название rl1 и ее ip-адрес в локальной сети 10.0.0.1. <br /> # Следующий шаг - это настройка самих ipfw и natd. <br /><br /> cd /etc <br /> vi natd.conf <br /><br /> # Вставьте в файл natd.conf следующие строки: <br /><br /> alias_address 192.168.15.99 <br /> target_address 10.10.10.1 <br /> log yes <br /> log_denied yes <br /> use_sockets yes <br /> same_ports yes <br /> unregistered_only yes <br /><br /> # Если хотите прочитать что значат каждая из этих строк подробнее, то смотрите "man natd" <br /> # Теперь пропишем ipfw и natd в автозагрузку. <br /><br /> cd /usr/local/etc/rc.d/ <br /> vi ipfw_natd.sh <br /><br /> # Вставьте в файл ipfw_natd.sh эти строки: <br /><br /> #!/bin/sh <br /> natd -f /etc/natd.conf <br /> ipfw add 500 divert natd all from any to any via rl0 <br /> ipfw add 501 pass all from any to any <br /><br /> # Это означает, что мы включаем маскарадинг с помощью natd через ipfw, разрешаем всем соединяться с сервером, <br /> # как если бы он был без файервола и разрешаем всем из локльной сети ходить в интернет. <br /> # Сделаем скрипт в автозагрузке выполняемым <br /><br /> chmod +x ipfw_natd.sh <br /><br /> reboot</span></p></main></div></div><div data-absolute="" class="ui fluid container" style="z-index: 6;"><div id="roof-wrap1" style="min-width: 100%; align-self: center; margin-top: 0px; min-height: 483px; padding: 10px 0px 0px; border-width: 0px 0px 4px; border-style: none none solid; border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(246, 187, 36); color: rgb(102, 102, 102); opacity: 1; background-color: rgb(255, 255, 255); background-position: 0% 0%; background-repeat: repeat; background-attachment: scroll; background-size: auto; box-shadow: rgb(0, 0, 0) 0px 0px 2px 2px; background-image: url(&quot;1567075815596/sama2.png&quot;);" class=""><div id="roof1" data-jkit="[slideshow:interval=7000;speed=250;animation=fade]"><img src="files/roof/dresden.jpg"><img src="files/roof/moskau.jpg"><img src="1589641442742/berlin.jpg"></div></div></div><div data-absolute="" style="z-index: 5;"><div id="roof-wrap2" style="margin-left: 0px; margin-right: 0px; margin-top: 0px; min-height: 155px; padding: 10px 0px 0px; border-width: 0px 0px 4px; border-style: none none solid; border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(246, 187, 36); color: rgb(102, 102, 102); opacity: 1; background-color: rgb(255, 255, 255); background-position: 0% 0%; background-repeat: repeat; background-attachment: scroll; background-image: url(&quot;1567075817539/sama2.png&quot;);" class=""><div id="roof2"><img src="files/roof/site2.gif" width="100%"></div></div></div><div data-absolute="" class="ui container" style="z-index: 4;"><div class="" id="copyright" style="margin-left: 5px; min-width: 50px; align-self: center; margin-bottom: 148px; min-height: 38px; border-style: none; border-color: rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-repeat: repeat; background-attachment: scroll;"><p><a style="color: #6aa3b1;" href="//redaktr.com" target="_blank" title="Redaktr.com - твой бесплатный сайт в облаке! Начни redaktировать прямо сейчас!"><i style="text-shadow: 1px 1px 1px black;" class="fa fa-cloud-upload fa-3x"></i></a></p></div></div><div data-absolute="" class="ui container" style="z-index: 3;"><div class="" id="live-internet" style="margin-left: 70px; min-width: 88px; align-self: center; margin-bottom: 149px; min-height: 31px; border-style: none; border-color: rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-repeat: repeat; background-attachment: scroll;"><p><script>document.write("<a href='https://www.liveinternet.ru/click' " + "target=_blank><img src='https://counter.yadro.ru/hit?t13.12;r" + escape(document.referrer) + ((typeof(screen) == "undefined") ? "" : ";s" + screen.width + "*" + screen.height + "*" + (screen.colorDepth ? screen.colorDepth : screen.pixelDepth)) + ";u" + escape(document.URL) + ";" + Math.random() + "' alt='' title='LiveInternet: показано число просмотров за 24" + " часа, посетителей за 24 часа и за сегодня' " + "border='0' width='88' height='31'><\/a>")</script></p></div></div><div data-absolute="" style="z-index: 2;"><div id="main-footer" style="margin-left: 0px; margin-right: 0px; margin-bottom: 0px; min-height: 177px; border-style: none; border-color: rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-position: 50% 0px; background-repeat: no-repeat; background-attachment: scroll; background-image: url(&quot;1567149113516/motherboard.png&quot;);" class=""></div></div><div data-absolute="" style="z-index: 1;"><div id="wholebg" style="margin: 0px; flex: 1 1 auto; border-style: none; border-color: rgb(0, 0, 0); color: rgb(102, 102, 102); opacity: 1; background-position: 0% 0%; background-repeat: repeat; background-attachment: scroll; background-image: url(&quot;1567075817543/leather_1.png&quot;);" class=""></div></div></div></body></html>